---
title: "#MenstruAcción"
subtitle: "Datos de 2020 - Marzo"
date: "Mayo de 2020"
output: html_notebook
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(EnvStats)
library(tidyverse)
library(ggridges)
library(openxlsx)
library(viridis)
library(readxl)
library(magrittr)
library(scales)
library(kableExtra)
library(ggrepel)
library(directlabels)
library(lubridate)
```

```{r}
datos <- readRDS("Fuentes/precios-gestion-menstrual-2020-03-23-limpio.RDS")
```

Ordenadas las provincias por precio promedio, de menor a mayor.      

Cargo la estimación, por provincia, de personas que menstrúan. Esto sale de las proyecciones poblacionales del INDEC para 2020, teniendo en cuenta que la menarca se estima en los 13 años y la menopausia en 49 años. Estos datos se van a utilizar para ponderar el precio promedio de cada provincia a la hora de agregar en un indicador nacional.      
                 
Además, considerando que hay outliers (valores atípicos) en los precios unitarios, a la hora de calcular los promedios de precios provinciales remuevo las colas, utilizando una media alfa podada:     

- alfa = 2.5%

```{r echo=FALSE, message=FALSE, warning=FALSE}
menstruan <- read_excel("Fuentes/poblaciones.xls")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
menstruan <- menstruan %>% 
  mutate(total = sum(Menstruan),
         pond = Menstruan/total) %>% 
  select(Provincia, pond)
```

# Resultados

## Total Nacional

### Toallitas

* Precio promedio por unidad
```{r echo=FALSE, message=FALSE, warning=FALSE}
toallitas <- datos %>% 
  filter(Categoría == "toallitas") %>%
  group_by(Provincia) %>% 
  summarise(prom = mean(precio_unidad, trim = 0.025)) %>% 
  left_join(., menstruan, by = "Provincia")

valor_toallitas <- weighted.mean(toallitas$prom, toallitas$pond)

print(paste("Toallitas: El precio promedio por unidad es de $", round(valor_toallitas, 2)))
```

* Gasto por año por persona

Teniendo en cuenta:     
ciclos por año: 13      
productos utilizados por ciclo: 22

```{r echo=FALSE, message=FALSE, warning=FALSE}
ciclos_por_anio <- 13
productos_por_ciclo <- 22
productos_por_anio <- ciclos_por_anio * productos_por_ciclo

gasto_por_anio_toallitas <- valor_toallitas * productos_por_anio

print(paste("Toallitas: El gasto promedio por año por persona es de $", round(gasto_por_anio_toallitas, 2)))
```

### Tampones

* Precio promedio por unidad
```{r echo=FALSE, message=FALSE, warning=FALSE}
tampones <- datos %>% 
  filter(Categoría == "tampones") %>%
  group_by(Provincia) %>% 
  summarise(prom = mean(precio_unidad, trim = 0.025)) %>% 
  left_join(., menstruan, by = "Provincia")

valor_tampones <- weighted.mean(tampones$prom, tampones$pond)

print(paste("Tampones: El precio promedio por unidad es de $", round(valor_tampones, 2)))
```

* Gasto por año por persona

Teniendo en cuenta:     
ciclos por año: 13      
productos utilizados por ciclo: 22

```{r echo=FALSE, message=FALSE, warning=FALSE}
gasto_por_anio_tampones <- valor_tampones * productos_por_anio

print(paste("Tampones: El gasto promedio por año por persona es de $", round(gasto_por_anio_tampones, 2)))
```

## Por provincia

### Toallitas

Gasto por año por persona, según provincia

```{r echo=FALSE, message=FALSE, warning=FALSE}
toallitas <- toallitas %>% 
  mutate(gasto_por_anio = round(prom * productos_por_anio, 2)) %>% 
  select(-prom, -pond)

toallitas
```

### Tampones

Gasto por año por persona, según provincia

```{r echo=FALSE, message=FALSE, warning=FALSE}
tampones <- tampones %>% 
  mutate(gasto_por_anio = round(prom * productos_por_anio, 2)) %>% 
  select(-prom, -pond)

tampones
```

#### Aumentos

```{r echo=FALSE, message=FALSE, warning=FALSE}
serie_inflacion <- read_excel("Fuentes/serie_inflacion.xlsx")
precios_pgm <- read_excel("Fuentes/serie_precios_pgm.xlsx")
```

```{r}
base100 <- serie_inflacion %>% 
  mutate(`Nivel General` = `Nivel General`/first(`Nivel General`) * 100,
         `Alimentos y bebidas no alcohólicas` = `Alimentos y bebidas no alcohólicas`/
           first(`Alimentos y bebidas no alcohólicas`) * 100,
         Salud = Salud/first(Salud) * 100)
```

```{r}
pgm_100 <- precios_pgm %>% 
  mutate(Toallitas = Toallitas/first(Toallitas) * 100,
         Tampones = Tampones/first(Tampones) * 100)
```

```{r}
base100 <- base100 %>% 
  left_join(., pgm_100, by = "Mes") %>% 
  pivot_longer(-Mes, names_to = "Categoria", values_to = "Indice") %>% 
  filter(!is.na(Indice)) %>% 
  mutate(Grupo = case_when(Categoria %in% c("Nivel General", "Alimentos y bebidas no alcohólicas", "Salud") ~ "IPC",
                           Categoria %in% c("Toallitas", "Tampones") ~ "PGM"))
```

```{r}
colorcitos <- c('royalblue4', 'royalblue', 
                'violetred', 'red')
```

```{r}
base100bis <- base100 %>% 
  mutate(Categoria = case_when(Categoria == "Alimentos y bebidas no alcohólicas" ~ "Alimentos",
                               TRUE ~ Categoria)) %>% 
  filter(Categoria != "Alimentos")
```

```{r}
ggplot(base100bis, aes(x = Mes, y = Indice, group = Categoria, color = Categoria)) +
  geom_line(data = base100bis %>% filter(Grupo == "PGM"), size = 1, alpha = 1) +
  geom_line(data = base100bis %>% filter(Grupo == "IPC"), alpha = 1, size = 1) +
  geom_point(data = base100bis %>% filter(Grupo == "PGM"), size = 2) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_color_manual(values = colorcitos) +
  expand_limits(x = as.POSIXct(c("2019-03-01", "2020-05-01"))) +
  geom_text(data = base100bis %>% filter(Mes == max(Mes)), aes(label = Categoria), 
                   hjust = -0.1) +
  labs(title = "Inflación de Toallitas y Tampones vs. Salud y Nivel General del IPC-INDEC",
       subtitle = "Marzo 2019 - Marzo 2020. ",
       x = "",
       y = "Indice de precios",
       caption = "Fuente: #MenstruAcción y EcoFeminitas") +
  scale_x_datetime(date_labels = "%m-%y", date_breaks = "1 month")
```



Limites: 

- posibles sesgos de la información de la página
- copas?
- no tenemos ponderadores de consumo toallitas/tampones
- algo sobre ingresos (histograma? deciles?)
- población trans (eph y censo 2020)
- comparación IPC general, leche u otros productos














