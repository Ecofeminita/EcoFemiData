---
title: "Indicadores sobre Trabajadoras de Servicio Doméstico"
subtitle: "Datos de la Encuesta Permanente de Hogares. 2do trimestre de 2019."
author: "Natsumi Shokida para Economía Femini(s)ta"
date: "Enero de 2020"
output: 
  html_notebook
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Se limpia la memoria y se cargan librerías útiles
rm(list = ls())
library(tidyverse)
library(httr)
library(stringr)
library(openxlsx)
library(haven)
library(readxl)
library(ggthemes)
library(scales)
library(knitr)
library(ggalt)
library(kableExtra)
library(formattable)
library(questionr)
library(eph)
source("funciones rama.R")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
date <- "2do trimestre 2019"
```

Aquí se presentan diversos indicadores referidos a las condiciones de trabajo de las trabajadoras que prestan servicio doméstico en hogares particulares. La información proviene de la base usuaria de la Encuesta Permanente de Hogares (EPH-INDEC-Argentina) y refiere a los 31 aglomerados urbanos relevados por la misma durante el 2do trimestre de 2019.

```{r echo=FALSE, message=FALSE, warning=FALSE}
base_individual <- eph::get_microdata(year = 2019, trimester = 2, type =  "individual") 
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Funciones útiles
# Funcion de redondeo para presentación (queda como character)
formato_porc <- function(numero, dec = 1){
  format(round(numero, digits = dec), nsmall = dec, decimal.mark = ",")
}

formato_pesos <- function(numero, dec = 2){
  paste0("$", format(round(numero, digits = dec), nsmall = dec, big.mark = ".", decimal.mark = ","))
}

formato_cantidad <- function(numero, dec = 0){
  format(round(numero, digits = dec), nsmall = dec, big.mark = ".", decimal.mark = ",")
}

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Modificaciones en la base
base_individual <- base_individual %>% 
  mutate(Sexo = as.character(CH04),
         Sexo = case_when(Sexo=="1" ~ "Varones",
                          Sexo=="2" ~ "Mujeres"),
         PP04D_COD = as.character(PP04D_COD),
         PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
                               nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
                               nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
                               nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
                               nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
         CALIFICACION = substr(PP04D_COD, 5, 5),
         CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
                                  CALIFICACION=="2" ~ "Técnicos",
                                  CALIFICACION=="3" ~ "Operativos",
                                  CALIFICACION=="4" ~ "No Calificados",
                                  TRUE ~ "0"),
         CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
         JERARQUIA = substr(PP04D_COD, 3, 3),
         JERARQUIA = case_when(JERARQUIA=="0" ~ "Dirección",
                               JERARQUIA=="1" ~ "Cuentapropia",
                               JERARQUIA=="2" ~ "Jefes",
                               JERARQUIA=="3" ~ "Trabajadores Asalariados",
                               TRUE ~ "0"),
         JERARQUIA = factor(JERARQUIA, c("Jefes", "Dirección", "Trabajadores Asalariados", "Cuentapropia")),
         NIVEL_EDUCATIVO = case_when(NIVEL_ED %in% c(1, 7) ~ "Sin Instrucción",
                                     NIVEL_ED %in% c(2, 3) ~ "Primaria",
                                     NIVEL_ED %in% c(4, 5) ~ "Secundaria",
                                     NIVEL_ED == 6         ~ "Superior",
                                     NIVEL_ED == 9         ~ "NS/NR"),
         NIVEL_EDUCATIVO = factor(NIVEL_EDUCATIVO, levels = c("Sin Instrucción", "Primaria", "Secundaria", "Superior")),
         GRUPO_EDAD = case_when(CH06 >= 14 & CH06 <= 29 ~ "de 14 a 29 años",
                                CH06 >= 30 & CH06 <= 64 ~ "de 30 a 64 años"))

# colores = c("#aa165a","#16aa66")
colores = c("#FE1764", "#00BDD6")
```

### Asalariades (en general)

Asalariades. Empleo sin descuento jubilatorio.
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
base_individual %>% 
  filter(ESTADO == 1,
         CAT_OCUP==3) %>% 
  summarise("Proporción de no Registrados" = formato_porc(sum(PONDERA[PP07H==2])/sum(PONDERA)*100))
```

Asalariades. Empleo sin descuento jubilatorio por sexo.
```{r echo=FALSE, message=FALSE, warning=FALSE}
base_individual %>% 
  filter(ESTADO==1,
         CAT_OCUP==3) %>% 
  group_by(Sexo) %>% 
  summarise("Proporción de no Registrados" = formato_porc(sum(PONDERA[PP07H==2])/sum(PONDERA)*100))
```

### Trabajadores del Servicio doméstico

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Mini base servicio doméstico. Todas ocupadas, asalariadas. 1899 casos muestrales
serv.dom <- base_individual %>% 
  filter(PP04B1 == 1)
```

Cantidad de personas que se dedican al servicio doméstico
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% summarise(cantidad = formato_cantidad(sum(PONDERA)))
```

Proporcion de mujeres y de varones dentro del servicio doméstico (indice de feminidad de trab. dom.)
```{r echo=FALSE, message=FALSE, warning=FALSE}
base_individual %>% 
  filter(PP04B1 == 1) %>% 
  mutate(Total = sum(PONDERA)) %>% 
  group_by(Sexo) %>% 
  summarise(Proporcion = formato_porc(sum(PONDERA)/unique(Total)*100))
```

Proporción de servicio doméstico dentro de las ocupadas mujeres.
```{r echo=FALSE, message=FALSE, warning=FALSE}
base_individual %>% 
  filter(ESTADO == 1,
         Sexo == "Mujeres") %>% 
  mutate(servicio.domestico = case_when(PP04B1 == 1 ~ "Sí",
                                        PP04B1 != 1 ~ "No")) %>% 
  group_by(servicio.domestico) %>% 
  summarise(cantidad = sum(PONDERA)) %>% 
  mutate(proporcion = formato_porc(cantidad/sum(cantidad)*100),
         cantidad = formato_cantidad(cantidad))
```

Proporción de servicio doméstico dentro de las asalariadas mujeres.
```{r echo=FALSE, message=FALSE, warning=FALSE}
base_individual %>% 
  filter(ESTADO == 1,
         CAT_OCUP == 3,
         Sexo == "Mujeres") %>% 
  mutate(servicio.domestico = case_when(PP04B1 == 1 ~ "Sí",
                                        PP04B1 != 1 ~ "No")) %>% 
  group_by(servicio.domestico) %>% 
  summarise(cantidad = sum(PONDERA)) %>% 
  mutate(proporcion = formato_porc(cantidad/sum(cantidad)*100),
         cantidad = formato_cantidad(cantidad))
```

### Derechos laborales, ingresos y carga horaria de las trabajadoras domésticas

En esta sección no se filtra a las mujeres, pero hacemos uso del femenino por la alta tasa de feminidad del sector.     
      
Proporción sin descuento jubilatorio dentro de trabajadoras domesticas
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  summarise("Proporción de no Registrados" = formato_porc(sum(PONDERA[PP07H==2])/sum(PONDERA)*100))
```

Ingreso promedio (de la ocupación principal) de las trabajadoras domésticas
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  summarise("Ingreso promedio" = formato_pesos(weighted.mean(P21, PONDIIO)),
            "50% cobra menos de" = formato_pesos(spatstat::weighted.median(P21, PONDIIO)))
```

Ingreso promedio (incluyendo ocupaciones secundarias) de las trabajadoras domésticas
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  summarise("Ingreso promedio" = formato_pesos(weighted.mean(P21+TOT_P12, PONDIIO)),
            "50% cobra menos de" = formato_pesos(spatstat::weighted.median(P21+TOT_P12, PONDIIO)))
```

Cantidad de hogares en los que trabajan
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$PP04B2, 
                        weights = serv.dom$PONDERA, 
                        exclude = NULL)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(cantidad_hogares = Var1, Porcentaje)
```

Intensidad
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$INTENSI, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Intensi = Var1, Porcentaje)
```
1 = Subocupado por insuficiencia horaria            
2 = Ocupado pleno         
3 = Sobreocupado            
4 = Ocupado que no trabajó en la semana               
            
Población subocupada: se refiere a la subocupación por insuficiencia de horas, visible u horaria, y comprende a los ocupados que trabajan menos de 35 horas semanales por causas involuntarias y están dispuestos a trabajar más horas.              
                  
#### En ese trabajo tiene...            

1 = Si       
2 = No        
                    
Vacaciones pagas?
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$PP07G1, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Vacaciones = Var1, Porcentaje)
```

Aguinaldo?
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$PP07G2, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Aguinaldo = Var1, Porcentaje)
```

Días pagos por enfermedad?
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$PP07G3, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Pago_enfermedad = Var1, Porcentaje)
```

Obra social?
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$PP07G4, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Obra_social = Var1, Porcentaje)
```

### Indicadores socio-demográficos

Composicion por edad de las trabajadoras del servicio doméstico
```{r echo=FALSE, message=FALSE, warning=FALSE}
as.data.frame(wtd.table(serv.dom$GRUPO_EDAD, weights = serv.dom$PONDERA, na.rm = FALSE)) %>% 
  mutate(total = sum(Freq),
         Porcentaje = formato_porc(Freq/total*100)) %>% 
  select(Edad = Var1, Porcentaje)
```

Jóvenes mujeres de entre 14 y 29 años que trabajan de servicio doméstico
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  filter(Sexo == "Mujeres",
         GRUPO_EDAD == "de 14 a 29 años") %>% 
  summarise(cantidad = formato_cantidad(sum(PONDERA)))
```

Jóvenes mujeres de entre 14 y 29 años que trabajan de servicio doméstico por nivel educativo
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  filter(Sexo == "Mujeres",
         GRUPO_EDAD == "de 14 a 29 años") %>%
  group_by(NIVEL_EDUCATIVO) %>% 
  summarise(cantidad = formato_cantidad(sum(PONDERA)))
```

Jóvenes mujeres de entre 14 y 29 años que trabajan de servicio doméstico por asistencia a establecimiento educativo
```{r echo=FALSE, message=FALSE, warning=FALSE}
serv.dom %>% 
  filter(Sexo == "Mujeres",
         GRUPO_EDAD == "de 14 a 29 años") %>%
  group_by(CH10) %>% 
  summarise(cantidad = sum(PONDERA)) %>% 
  ungroup() %>% 
  mutate(porcentaje = formato_porc(cantidad/sum(cantidad) * 100),
         cantidad = formato_cantidad(cantidad))
```

1: Asiste a un establecimiento educativo            
2: No asiste a establecimiento educativo, aunque asistió en el pasado          
3: Nunca asistió          

### Comparación entre ramas de la ocupación         

Considerando rama de actividad de la ocupación principal
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Implemento la función que construye la rama EPH con nombres descriptivos, directo desde la PP04B_COD
base_individual <- base_individual %>%
  mutate(rama.nombre = entra.cuchillo.salen.las.ramas(PP04B_COD))
```

```{r message=FALSE, warning=FALSE, include=FALSE}
asalariades <- base_individual %>%
  filter(ESTADO == 1,
         CAT_OCUP == 3)

as.data.frame(wtd.table(asalariades$rama.nombre, 
                        weights = asalariades$PONDERA, 
                        exclude = NULL))
```

```{r message=FALSE, warning=FALSE, include=FALSE}
table(asalariades$rama.nombre, asalariades$PP04B1, exclude = NULL)
# Hay casos de Servicio domestico en la rama pero que no tienen marcada la variable que las identifica como prestadoras de servicio doméstico en hogares, son 21 casos muestrales
```

```{r message=FALSE, warning=FALSE, include=FALSE}
prueba <- asalariades %>% 
  filter(rama.nombre == "Servicio domestico", 
         PP04B1 == 2)

table(prueba$PP04B_COD, exclude = NULL)
table(prueba$PP04B2, exclude = NULL)
# Los 21 casos tienen rama "9700", que en CAES Mercosur es "Actividades de los hogares como empleadores de personal doméstico", la misma rama que el resto, pero responder trabajar en "0 casas" y por eso no se tienen en cuenta hasta ahora, en la base serv.dom.
```

Asalariades. Indicadores por rama.
```{r echo=FALSE, message=FALSE, warning=FALSE}
asal.ramas <- asalariades %>% 
  mutate(total = sum(PONDERA)) %>% 
  group_by(rama.nombre) %>% 
  summarise(Proporcion = round(sum(PONDERA)/unique(total)*100, 1),
            Tasa.feminidad = round(sum(PONDERA[Sexo == "Mujeres"])/sum(PONDERA)*100, 1),
            Tasa.no.registro = round(sum(PONDERA[PP07H == 2])/sum(PONDERA)*100, 1),
            Ingreso.Promedio = weighted.mean(P21, PONDIIO)) %>% 
  arrange(-Tasa.feminidad)

asal.ramas
```

Ocupades. Indicadores por rama.
```{r echo=FALSE, message=FALSE, warning=FALSE}
ocup.ramas <- base_individual %>%
  filter(ESTADO == 1) %>% 
  mutate(total = sum(PONDERA)) %>% 
  group_by(rama.nombre) %>% 
  summarise(Proporcion = round(sum(PONDERA)/unique(total)*100, 1),
            Tasa.feminidad = round(sum(PONDERA[Sexo == "Mujeres"])/sum(PONDERA)*100, 1),
            Tasa.no.registro = round(sum(PONDERA[PP07H == 2])/sum(PONDERA)*100, 1),
            Ingreso.Promedio = weighted.mean(P21, PONDIIO)) %>% 
  arrange(-Tasa.feminidad)

ocup.ramas
```






